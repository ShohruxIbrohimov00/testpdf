{% extends "base.html" %}
{% block title %}Admin Kirish{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">

    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
            <a href="{{ url_for('index') }}" class="text-gray-700 hover:text-gray-900 transition">
                <i class="fa-solid fa-arrow-left text-2xl"></i>
            </a>
            <h1 class="text-xl font-bold text-gray-800">Admin Kirish</h1>
            <div class="w-10"></div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 sm:p-6 flex-1 flex flex-col items-center justify-center">

        <!-- Asosiy karta -->
        <div class="w-full max-w-md bg-white rounded-lg shadow-sm border border-gray-200 p-8 sm:p-10">

            <!-- Sarlavha -->
            <div class="text-center mb-10">
                <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-blue-100 text-blue-600 mb-6">
                    <i class="fa-solid fa-user-shield text-4xl"></i>
                </div>
                <h2 class="text-3xl font-bold text-gray-900">Admin Kirish</h2>
                <p class="text-gray-600 mt-2">O‘qituvchi paneliga kirish uchun ma'lumotlarni kiriting</p>
            </div>

            <!-- Forma -->
            <form id="admin-login-form" onsubmit="event.preventDefault(); handleLogin();" class="space-y-6">

                <div>
                    <label for="username-input" class="block text-sm font-semibold text-gray-700 mb-2">
                        Login
                    </label>
                    <input type="text" id="username-input" 
                           placeholder="Admin loginini kiriting" 
                           class="w-full px-5 py-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                           required autocomplete="username">
                </div>

                <div>
                    <label for="password-input" class="block text-sm font-semibold text-gray-700 mb-2">
                        Parol
                    </label>
                    <input type="password" id="password-input" 
                           placeholder="Parolni kiriting" 
                           class="w-full px-5 py-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                           required autocomplete="current-password">
                </div>

                <button type="submit" id="login-btn"
                        class="w-full py-5 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md hover:shadow-lg transition text-lg flex items-center justify-center gap-3">
                    <i class="fa-solid fa-right-to-bracket"></i>
                    Kirish
                </button>
            </form>

            <!-- Orqaga havola -->
            <div class="mt-8 text-center">
                <p class="text-sm text-gray-600">
                    Talaba bo‘lsangiz? 
                    <a href="{{ url_for('index') }}" class="text-blue-600 hover:text-blue-700 font-semibold underline-offset-4 hover:underline transition">
                        Bosh sahifaga qaytish
                    </a>
                </p>
            </div>

            <!-- Qo‘shimcha eslatma -->
            <div class="mt-8 p-5 bg-gray-50 border border-gray-200 rounded-lg">
                <p class="text-xs text-gray-600 text-center flex items-center justify-center gap-2">
                    <i class="fa-solid fa-circle-info text-blue-600"></i>
                    Faqat o‘qituvchilar va administratorlar ushbu sahifadan foydalanishi mumkin
                </p>
            </div>
        </div>
    </main>

    <!-- Footer (ixtiyoriy) -->
    <footer class="py-6 text-center text-xs text-gray-500 border-t border-gray-200 bg-white">
        © 2025 Imtihon Tizimi. Barcha huquqlar himoyalangan.
    </footer>
</div>
{% endblock %}

{% block scripts %}
<script>
    const adminTokenKey = 'admin_auth_token';
    const adminPanelUrl = '{{ url_for('admin_dash') }}';

    function handleLogin() {
        const username = document.getElementById('username-input').value.trim();
        const password = document.getElementById('password-input').value.trim();
        const loginBtn = document.getElementById('login-btn');

        if (!username || !password) {
            Swal.fire('Xato', 'Login va parolni to‘ldiring.', 'warning');
            return;
        }

        loginBtn.disabled = true;
        loginBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i> Tekshirilmoqda...';

        fetch('/api/admin/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password })
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 'success') {
                localStorage.setItem(adminTokenKey, data.token);

                Swal.fire({
                    icon: 'success',
                    title: 'Muvaffaqiyatli!',
                    text: 'Admin paneliga yo‘naltirilmoqda...',
                    timer: 1500,
                    showConfirmButton: false
                }).then(() => {
                    window.location.href = adminPanelUrl;
                });
            } else {
                Swal.fire('Xato', data.message || 'Login yoki parol noto‘g‘ri.', 'error');
            }
        })
        .catch(err => {
            console.error('Server xatosi:', err);
            Swal.fire('Ulanish xatosi', 'Server bilan bog‘lanib bo‘lmadi.', 'error');
        })
        .finally(() => {
            loginBtn.disabled = false;
            loginBtn.innerHTML = '<i class="fa-solid fa-right-to-bracket mr-2"></i> Kirish';
        });
    }
</script>
{% endblock %}
